<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buski √áay - Online Sipari≈ü</title>
  <link rel="icon" type="image/png" href="favicon.png">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #1e293b;
      line-height: 1.6;
    }
    
    .screen {
      display: none;
      min-height: 100vh;
    }
    
    .screen.active {
      display: block;
    }
    
    /* Login/Register Styles */
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }
    
    .auth-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      padding: 40px;
      width: 100%;
      max-width: 400px;
      text-align: center;
    }
    
    .logo-section {
      margin-bottom: 30px;
    }
    
    .logo {
      width: 120px;
      height: auto;
      margin-bottom: 20px;
    }
    
    .auth-title {
      font-size: 28px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 10px;
    }
    
    .auth-subtitle {
      color: #64748b;
      font-size: 16px;
      margin-bottom: 30px;
    }
    
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #374151;
      font-weight: 500;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f9fafb;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3b82f6;
      background: white;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .password-field {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: #6b7280;
      font-size: 18px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 16px;
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.3);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }
    
    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .link-btn {
      background: none;
      border: none;
      color: #3b82f6;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      margin: 8px 0;
      font-size: 14px;
    }
    
    .link-btn:hover {
      text-decoration: underline;
    }
    
    .error-message {
      color: #ef4444;
      font-size: 14px;
      margin-top: 8px;
      text-align: left;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
      font-weight: 500;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: #ef4444;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #e5e7eb;
      border-top: 2px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* E-commerce Order Screen Styles */
    .order-container {
      min-height: 100vh;
      background: #f8fafc;
      position: relative;
      max-width: 900px;
      margin: 0 auto;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: visible;
    }

    .header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      padding: 16px 20px;
      text-align: center;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      border-radius: 0 0 20px 20px;
      margin: 0 20px;
    }

    .header-content h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .header-content p {
      font-size: 14px;
      opacity: 0.9;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      padding-bottom: 20px; /* Reduced padding since cart is now fixed */
    }

    .menu-item {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
      border: 1px solid #e2e8f0;
      position: relative;
      overflow: hidden;
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }

    .menu-item::before {
      content: attr(data-emoji);
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 60px;
      opacity: 0.1;
      transform: rotate(15deg);
    }

    .menu-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      border-color: #3b82f6;
    }

    .menu-item h3 {
      color: #1e293b;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }

    .menu-item p {
      color: #64748b;
      font-size: 13px;
      margin-bottom: 12px;
      line-height: 1.4;
      position: relative;
      z-index: 1;
    }

    .price {
      font-size: 20px;
      font-weight: 700;
      color: #059669;
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      background: #f8fafc;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
    }

    .quantity-btn {
      width: 36px;
      height: 36px;
      border: 2px solid #3b82f6;
      background: white;
      color: #3b82f6;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quantity-btn:hover {
      background: #3b82f6;
      color: white;
      transform: scale(1.05);
    }

    .quantity-btn:disabled {
      border-color: #cbd5e1;
      color: #cbd5e1;
      cursor: not-allowed;
      transform: none;
    }

    .quantity-display {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      min-width: 40px;
      text-align: center;
      padding: 8px 12px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    .add-to-cart-btn {
      width: 100%;
      padding: 12px 24px;
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px rgba(5, 150, 105, 0.3);
      position: relative;
      z-index: 1;
      margin-top: auto;
    }

    .add-to-cart-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
    }

    .cart-fab {
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
      transition: all 0.3s ease;
      z-index: 150;
    }

    .cart-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 35px rgba(59, 130, 246, 0.5);
    }

    .cart-fab.pulse {
      animation: cartPulse 0.6s ease-in-out;
    }

    @keyframes cartPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .cart-icon {
      transition: all 0.3s ease;
    }

    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .cart-count.update {
      animation: countUpdate 0.4s ease-in-out;
    }

    @keyframes countUpdate {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      display: flex;
      padding: 12px 24px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      border-top: 1px solid #e2e8f0;
      z-index: 50;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #64748b;
    }

    .nav-item:hover {
      background: #f1f5f9;
      color: #3b82f6;
    }

    .nav-item.active {
      color: #3b82f6;
      background: #eff6ff;
    }

    .nav-icon {
      font-size: 24px;
      margin-bottom: 4px;
    }

    .nav-text {
      font-size: 12px;
      font-weight: 500;
    }

    /* Cart Dropdown */
    .cart-dropdown {
      position: fixed;
      bottom: 170px;
      right: 20px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      width: 320px;
      max-height: 400px;
      overflow: hidden;
      display: none;
      z-index: 140;
      border: 1px solid #e2e8f0;
    }

    .cart-dropdown.show {
      display: block;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive cart dropdown */
    @media (max-width: 480px) {
      .cart-dropdown {
        width: calc(100% - 40px);
        right: 20px;
        left: 20px;
        max-height: 60vh;
        bottom: 170px;
      }
      
      .cart-items {
        max-height: 200px;
      }
    }

    .cart-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-height: 400px;
      overflow: hidden;
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
    }

    .cart-header h3 {
      font-size: 20px;
      font-weight: 600;
      color: #1e293b;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #64748b;
      cursor: pointer;
      padding: 4px;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: #e2e8f0;
      color: #1e293b;
    }

    .cart-items {
      padding: 16px 20px;
      max-height: 250px;
      overflow-y: auto;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-info {
      flex: 1;
    }

    .cart-item-name {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
    }

    .cart-item-price {
      color: #64748b;
      font-size: 14px;
    }

    .cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cart-item-quantity button {
      width: 28px;
      height: 28px;
      border: 1px solid #e2e8f0;
      background: white;
      color: #64748b;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .cart-item-quantity button:hover {
      background: #f1f5f9;
      color: #1e293b;
    }

    .cart-footer {
      padding: 16px 20px;
      border-top: 1px solid #e2e8f0;
      background: #f8fafc;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
    }

    .place-order-btn {
      width: 100%;
      padding: 12px 20px;
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px rgba(5, 150, 105, 0.3);
    }

    .place-order-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
    }

    /* Profile Screen Styles */
    .profile-container {
      min-height: 100vh;
      background: #f8fafc;
      padding-bottom: 100px;
      max-width: 900px;
      margin: 0 auto;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .profile-header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      padding: 30px 20px;
      text-align: center;
      border-radius: 0 0 20px 20px;
      margin: 0 20px;
    }

    .profile-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .profile-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid white;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-details h2 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .profile-details p {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 3px;
    }

    .profile-tabs {
      display: flex;
      background: white;
      border-bottom: 1px solid #e2e8f0;
      overflow-x: auto;
      margin: 0 20px;
      border-radius: 12px 12px 0 0;
      margin-top: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 14px 10px;
      background: none;
      border: none;
      color: #64748b;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      border-bottom: 2px solid transparent;
    }

    .tab-btn:hover {
      color: #3b82f6;
      background: #f8fafc;
    }

    .tab-btn.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
      background: #eff6ff;
    }

    .tab-content {
      padding: 20px;
      margin: 0 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .info-card,
    .history-card,
    .password-card,
    .settings-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid #e2e8f0;
      max-width: 100%;
    }

    .info-card h3,
    .history-card h3,
    .password-card h3,
    .settings-card h3 {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 16px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #f1f5f9;
      max-width: 100%;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 500;
      color: #64748b;
    }

    .order-history {
      max-height: 400px;
      overflow-y: auto;
    }

    .order-item {
      background: #f8fafc;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid #e2e8f0;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .order-date {
      font-weight: 600;
      color: #1e293b;
    }

    .order-total {
      font-weight: 600;
      color: #059669;
    }

    .order-items {
      font-size: 14px;
      color: #64748b;
      line-height: 1.5;
    }

    .profile-image-upload {
      margin-bottom: 24px;
    }

    .profile-image-upload h4 {
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 12px;
    }

    .profile-image-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      border: 3px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .profile-image-preview:hover {
      border-color: #3b82f6;
    }

    .profile-image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .upload-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .profile-image-preview:hover .upload-overlay {
      opacity: 1;
    }

    .upload-overlay span {
      font-size: 24px;
      margin-bottom: 4px;
    }

    .upload-overlay p {
      font-size: 12px;
      text-align: center;
    }

    .danger-zone {
      margin-top: 24px;
      padding: 20px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
    }

    .danger-zone h4 {
      color: #dc2626;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .danger-warning {
      text-align: center;
    }

    .danger-warning p {
      color: #dc2626;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .btn-danger {
      background: #dc2626;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-danger:hover {
      background: #b91c1c;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #64748b;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 12px;
    }

    .btn-secondary:hover {
      background: #475569;
    }

    .action-buttons {
      background: white;
      padding: 16px 24px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: center;
      gap: 16px;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .menu-grid {
        grid-template-columns: 1fr;
        padding: 16px;
        gap: 16px;
        max-width: 100%;
      }

      .menu-item {
        padding: 16px;
      }

      .order-container,
      .profile-container {
        max-width: 100%;
        margin: 0;
        border-radius: 0;
        box-shadow: none;
        min-height: 100vh;
      }

      .header,
      .profile-header {
        margin: 0;
        border-radius: 0;
      }

      .profile-tabs {
        flex-wrap: wrap;
        margin: 0;
        border-radius: 0;
      }

      .tab-content {
        margin: 0;
        padding: 16px;
      }

      .tab-btn {
        min-width: 120px;
      }

      .action-buttons {
        flex-direction: column;
        gap: 12px;
        max-width: 100%;
        margin: 0 16px;
      }

      .btn-secondary,
      .btn-danger {
        width: 100%;
        margin-right: 0;
      }
    }
  </style>
  <!-- ALT NAVƒ∞GASYON K√ú√á√úLTME CSS EKLENDƒ∞ -->
  <style>
  .bottom-nav, .profile-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    display: flex;
    padding: 6px 0;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
    border-top: 1px solid #e2e8f0;
    z-index: 100;
    max-width: 900px;
    margin: 0 auto;
    height: 56px;
  }
  .nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    color: #64748b;
    font-size: 11px;
    min-width: 0;
  }
  .nav-item .nav-icon {
    font-size: 18px;
    margin-bottom: 0;
  }
  .nav-item .nav-text {
    font-size: 11px;
    font-weight: 500;
  }
  .nav-item.active {
    color: #3b82f6;
    background: #eff6ff;
  }
  @media (max-width: 900px) {
    .bottom-nav, .profile-bottom-nav {
      max-width: 100vw;
    }
  }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="screen active">
    <div class="auth-container">
      <div class="auth-card">
        <div class="logo-section">
          <img src="../assets/images/logo1.png" alt="Buski √áay" class="logo">
          <h1 class="auth-title">Ho≈ü Geldiniz</h1>
          <p class="auth-subtitle">Hesabƒ±nƒ±za giri≈ü yapƒ±n</p>
        </div>
        
        <form id="loginForm">
          <div class="form-group">
            <label for="loginEmail">E-posta</label>
            <input type="email" id="loginEmail" required>
          </div>
          
          <div class="form-group">
            <label for="loginPassword">≈ûifre</label>
            <div class="password-field">
              <input type="password" id="loginPassword" required>
              <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
            </div>
          </div>
          
          <button type="submit" class="btn">
            <span class="loading" style="display: none;"></span>
            Giri≈ü Yap
          </button>
          
          <div class="error-message" id="loginError"></div>
        </form>
        
        <div style="margin-top: 20px;">
          <button class="link-btn" onclick="showRegister()">Hesabƒ±nƒ±z yok mu? Kayƒ±t olun</button>
          <br>
          <button class="link-btn" onclick="showForgotPassword()">≈ûifrenizi mi unuttunuz?</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Register Screen -->
  <div id="registerScreen" class="screen">
    <div class="auth-container">
      <div class="auth-card">
        <div class="logo-section">
          <img src="../assets/images/logo1.png" alt="Buski √áay" class="logo">
          <h1 class="auth-title">Hesap Olu≈ütur</h1>
          <p class="auth-subtitle">Yeni hesabƒ±nƒ±zƒ± olu≈üturun</p>
        </div>
        
        <form id="registerForm">
          <div class="form-group">
            <label for="registerName">Ad</label>
            <input type="text" id="registerName" required>
          </div>
          
          <div class="form-group">
            <label for="registerSurname">Soyad</label>
            <input type="text" id="registerSurname" required>
          </div>
          
          <div class="form-group">
            <label for="registerEmail">E-posta</label>
            <input type="email" id="registerEmail" required>
          </div>
          
          <div class="form-group">
            <label for="registerFloor">Kat</label>
            <select id="registerFloor" required>
              <option value="">Kat se√ßin</option>
              <option value="1">1. Kat</option>
              <option value="2">2. Kat</option>
              <option value="3">3. Kat</option>
              <option value="4">4. Kat</option>
              <option value="5">5. Kat</option>
              <option value="6">6. Kat</option>
              <option value="7">7. Kat</option>
              <option value="8">8. Kat</option>
              <option value="9">9. Kat</option>
              <option value="10">10. Kat</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="registerDepartment">Departman</label>
            <input type="text" id="registerDepartment" required>
          </div>
          
          <div class="form-group">
            <label for="registerPassword">≈ûifre</label>
            <div class="password-field">
              <input type="password" id="registerPassword" required>
              <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">üëÅÔ∏è</button>
            </div>
          </div>
          
          <div class="form-group">
            <label for="registerPasswordRepeat">≈ûifre Tekrar</label>
            <div class="password-field">
              <input type="password" id="registerPasswordRepeat" required>
              <button type="button" class="password-toggle" onclick="togglePassword('registerPasswordRepeat')">üëÅÔ∏è</button>
            </div>
          </div>
          
          <button type="submit" class="btn">
            <span class="loading" style="display: none;"></span>
            Kayƒ±t Ol
          </button>
          
          <div class="error-message" id="registerError"></div>
        </form>
        
        <div style="margin-top: 20px;">
          <button class="link-btn" onclick="showLogin()">Zaten hesabƒ±nƒ±z var mƒ±? Giri≈ü yapƒ±n</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Forgot Password Screen -->
  <div id="forgotPasswordScreen" class="screen">
    <div class="auth-container">
      <div class="auth-card">
        <div class="logo-section">
          <img src="../assets/images/logo1.png" alt="Buski √áay" class="logo">
          <h1 class="auth-title">≈ûifre Sƒ±fƒ±rlama</h1>
          <p class="auth-subtitle">E-posta adresinizi girin</p>
        </div>
        
        <form id="forgotPasswordForm">
          <div class="form-group">
            <label for="forgotEmail">E-posta</label>
            <input type="email" id="forgotEmail" required>
          </div>
          
          <button type="submit" class="btn">
            <span class="loading" style="display: none;"></span>
            ≈ûifre Sƒ±fƒ±rlama Linki G√∂nder
          </button>
          
          <div class="error-message" id="forgotError"></div>
        </form>
        
        <div style="margin-top: 20px;">
          <button class="link-btn" onclick="showLogin()">Giri≈ü sayfasƒ±na d√∂n</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Screen -->
  <div id="orderScreen" class="screen">
    <div class="order-container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <h1>Buski √áay</h1>
          <p>Ho≈ü geldiniz, <span id="userName">Kullanƒ±cƒ±</span>!</p>
        </div>
      </header>

      <!-- Menu Grid -->
      <div class="menu-grid" id="menuGrid">
        <!-- Menu items will be loaded here -->
      </div>

      <!-- Cart FAB -->
      <div class="cart-fab" onclick="toggleCart()">
        <span class="cart-icon">üõí</span>
        <span class="cart-count" id="cartCount">0</span>
      </div>

      <!-- Bottom Navigation -->
      <nav class="bottom-nav">
        <div class="nav-item active" onclick="showOrderTab()">
          <span class="nav-icon">üçΩÔ∏è</span>
          <span class="nav-text">Men√º</span>
        </div>
        <div class="nav-item" onclick="showProfileTab()">
          <span class="nav-icon">üë§</span>
          <span class="nav-text">Profil</span>
        </div>
      </nav>

      <!-- Cart Dropdown -->
      <div id="cartDropdown" class="cart-dropdown">
        <div class="cart-content">
          <div class="cart-header">
            <h3>Sepetim</h3>
            <button class="close-btn" onclick="hideCart()">‚úï</button>
          </div>
          <div class="cart-items" id="cartItemsDiv">
            <!-- Cart items will be displayed here -->
          </div>
          <div class="cart-footer">
            <div class="cart-total">
              <span>Toplam:</span>
              <span id="cartTotal">0 ‚Ç∫</span>
            </div>
            <button class="place-order-btn" onclick="placeOrder()">
              Sipari≈ü Ver
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Screen -->
  <div id="profileScreen" class="screen">
    <div class="profile-container">
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="profile-info">
          <div class="profile-avatar">
            <img id="profileImagePreview" src="../assets/images/logo1.png" alt="Profil">
          </div>
          <div class="profile-details">
            <h2 id="profileUserName">Kullanƒ±cƒ±</h2>
            <p id="profileUserEmail">kullanici@email.com</p>
            <p id="profileUserFloor">Kat: -</p>
            <p id="profileUserDepartment">Departman: -</p>
          </div>
        </div>
      </div>

      <!-- Profile Tabs -->
      <div class="profile-tabs">
        <button class="tab-btn active" onclick="showProfileSubTab('info')">Bilgiler</button>
        <button class="tab-btn" onclick="showProfileSubTab('history')">Ge√ßmi≈ü Sipari≈üler</button>
        <button class="tab-btn" onclick="showProfileSubTab('password')">≈ûifre Deƒüi≈ütir</button>
        <button class="tab-btn" onclick="showProfileSubTab('settings')">Ayarlar</button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Info Tab -->
        <div id="info-section" class="tab-panel active">
          <div class="info-card">
            <h3>Ki≈üisel Bilgiler</h3>
            <div class="info-item">
              <span class="info-label">Ad Soyad:</span>
              <span id="profileFullName">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">E-posta:</span>
              <span id="profileEmail">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Kat:</span>
              <span id="profileFloor">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Departman:</span>
              <span id="profileDept">-</span>
            </div>
          </div>
        </div>

        <!-- History Tab -->
        <div id="history-section" class="tab-panel">
          <div class="history-card">
            <h3>Sipari≈ü Ge√ßmi≈üi</h3>
            <div id="orderHistory" class="order-history">
              <!-- Order history will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Password Tab -->
        <div id="password-section" class="tab-panel">
          <div class="password-card">
            <h3>≈ûifre Deƒüi≈ütir</h3>
            <form id="changePasswordForm">
              <div class="form-group">
                <label for="currentPassword">Mevcut ≈ûifre</label>
                <div class="password-field">
                  <input type="password" id="currentPassword" required>
                  <button type="button" class="password-toggle" onclick="togglePassword('currentPassword')">üëÅÔ∏è</button>
                </div>
              </div>
              <div class="form-group">
                <label for="newPassword">Yeni ≈ûifre</label>
                <div class="password-field">
                  <input type="password" id="newPassword" required>
                  <button type="button" class="password-toggle" onclick="togglePassword('newPassword')">üëÅÔ∏è</button>
                </div>
              </div>
              <div class="form-group">
                <label for="confirmPassword">Yeni ≈ûifre Tekrar</label>
                <div class="password-field">
                  <input type="password" id="confirmPassword" required>
                  <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">üëÅÔ∏è</button>
                </div>
              </div>
              <button type="submit" class="btn">≈ûifre Deƒüi≈ütir</button>
            </form>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-section" class="tab-panel">
          <div class="settings-card">
            <h3>Profil Ayarlarƒ±</h3>
            
            <!-- Profile Image Upload -->
            <div class="profile-image-upload">
              <h4>Profil Fotoƒürafƒ±</h4>
              <div class="profile-image-preview" onclick="document.getElementById('profileImageInput').click()">
                <img id="profileImagePreview2" src="../assets/images/logo1.png" alt="Profil">
                <div class="upload-overlay">
                  <span>üì∑</span>
                  <p>Fotoƒüraf Deƒüi≈ütir</p>
                </div>
              </div>
              <input type="file" id="profileImageInput" accept="image/*" style="display: none;" onchange="handleProfileImageUpload()">
            </div>

            <!-- Edit Profile Form -->
            <form id="editProfileForm">
              <h4>Bilgileri D√ºzenle</h4>
              <div class="form-group">
                <label for="editName">Ad</label>
                <input type="text" id="editName" required>
              </div>
              <div class="form-group">
                <label for="editDepartment">Departman</label>
                <input type="text" id="editDepartment" required>
              </div>
              <div class="form-group">
                <label for="editFloor">Kat</label>
                <select id="editFloor" required>
                  <option value="1">1. Kat</option>
                  <option value="2">2. Kat</option>
                  <option value="3">3. Kat</option>
                  <option value="4">4. Kat</option>
                  <option value="5">5. Kat</option>
                  <option value="6">6. Kat</option>
                  <option value="7">7. Kat</option>
                  <option value="8">8. Kat</option>
                  <option value="9">9. Kat</option>
                  <option value="10">10. Kat</option>
                </select>
              </div>
              <button type="submit" class="btn">Bilgileri G√ºncelle</button>
            </form>

            <!-- Danger Zone -->
            <div class="danger-zone">
              <h4>Tehlikeli B√∂lge</h4>
              <div class="danger-warning">
                <p>‚ö†Ô∏è Bu i≈ülem geri alƒ±namaz!</p>
                <button class="btn-danger" onclick="deleteAccount()">Hesabƒ± Sil</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Bottom Navigation (Profil i√ßin) -->
      <nav class="bottom-nav profile-bottom-nav">
        <div class="nav-item" onclick="showOrderTab()">
          <span class="nav-icon">üçΩÔ∏è</span>
          <span class="nav-text">Men√º</span>
        </div>
        <div class="nav-item active" onclick="showProfileTab()">
          <span class="nav-icon">üë§</span>
          <span class="nav-text">Profil</span>
        </div>
      </nav>
      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn-secondary" onclick="showOrderTab()">Men√ºye D√∂n</button>
        <button class="btn-danger" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <!-- Firebase Config -->
  <script src="firebase-config.js"></script>
  
  <script>
    // Global variables
    let isPasswordVisible = {};
    let currentUser = null;
    let cartItems = [];
    let menu = [];
    let userData = {};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    
    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
      checkAuth();
    });

    function initializeApp() {
      // Set random sentence for animated text
      const sentences = [
        "√áay keyfinizi ke≈üfedin! ‚òï",
        "Taze demlenmi≈ü √ßaylar! üçµ",
        "Sƒ±cak i√ßecekler burada! üî•",
        "Lezzetli √ßay √ße≈üitleri! üåø"
      ];
      const randomSentence = sentences[Math.floor(Math.random() * sentences.length)];
      
      // Setup event listeners
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('registerForm').addEventListener('submit', handleRegister);
      document.getElementById('forgotPasswordForm').addEventListener('submit', handleForgotPassword);
    }

    function checkAuth() {
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          currentUser = user;
          loadUserData();
          showScreen('orderScreen');
        } else {
          currentUser = null;
          showScreen('loginScreen');
        }
      });
    }

    function loadUserData() {
      console.log("loadUserData √ßaƒürƒ±ldƒ±, currentUser:", currentUser);
      
      firebase.firestore().collection('users').doc(currentUser.uid).get()
        .then((doc) => {
          console.log("Firestore'dan gelen user data:", doc.data());
          if (doc.exists) {
            userData = doc.data();
            console.log("userData set edildi:", userData);
            document.getElementById('userName').textContent = userData.name || 'Kullanƒ±cƒ±';
            
            // Update profile screen data
            document.getElementById('profileUserName').textContent = userData.name || 'Kullanƒ±cƒ±';
            document.getElementById('profileUserEmail').textContent = userData.email || 'kullanici@email.com';
            document.getElementById('profileUserFloor').textContent = `Kat: ${userData.floor || '-'}`;
            document.getElementById('profileUserDepartment').textContent = `Departman: ${userData.department || '-'}`;
            
            document.getElementById('profileFullName').textContent = `${userData.name || ''} ${userData.surname || ''}`;
            document.getElementById('profileEmail').textContent = userData.email || '-';
            document.getElementById('profileFloor').textContent = userData.floor || '-';
            document.getElementById('profileDept').textContent = userData.department || '-';
            
            // Update profile image if exists
            if (userData.profileImage) {
              document.getElementById('profileImagePreview').src = userData.profileImage;
              document.getElementById('profileImagePreview2').src = userData.profileImage;
            }
            
            loadMenu();
          }
        })
        .catch((error) => {
          console.error("Error loading user data:", error);
        });
    }

    function loadMenu() {
      console.log("loadMenu √ßaƒürƒ±ldƒ±, userData:", userData);
      console.log("userData.floor:", userData.floor, "type:", typeof userData.floor);
      
      if (!userData || !userData.floor) {
        console.log("userData veya floor bilgisi eksik, varsayƒ±lan men√º y√ºkleniyor");
        // Varsayƒ±lan men√º y√ºkle
        menu = [
          { name: '√áay', price: 5, description: 'Sƒ±cak √ßay' },
          { name: 'Kahve', price: 8, description: 'Sƒ±cak kahve' },
          { name: 'Su', price: 2, description: 'Soƒüuk su' },
          { name: 'Sandvi√ß', price: 15, description: 'Taze sandvi√ß' }
        ];
        displayMenu();
        return;
      }

      let menuCollection = 'kat123';
      if (userData.floor >= 4 && userData.floor <= 6) {
        menuCollection = 'kat456';
      } else if (userData.floor >= 7) {
        menuCollection = 'kat78910';
      }

      console.log("Men√º koleksiyonu:", menuCollection);

      firebase.firestore().collection('menu').doc(menuCollection).get()
        .then((docSnapshot) => {
          console.log("Firebase'den gelen veri:", docSnapshot.data());
          if (docSnapshot.exists) {
            const menuData = docSnapshot.data();
            menu = menuData.items || menuData.menu || [];
            console.log("Toplam men√º √∂ƒüesi:", menu.length);
            displayMenu();
          } else {
            console.log("Men√º dok√ºmanƒ± bulunamadƒ±, varsayƒ±lan men√º y√ºkleniyor");
            // Varsayƒ±lan men√º y√ºkle
            menu = [
              { name: '√áay', price: 5, description: 'Sƒ±cak √ßay' },
              { name: 'Kahve', price: 8, description: 'Sƒ±cak kahve' },
              { name: 'Su', price: 2, description: 'Soƒüuk su' },
              { name: 'Sandvi√ß', price: 15, description: 'Taze sandvi√ß' }
            ];
            displayMenu();
          }
        })
        .catch((error) => {
          console.error("Error loading menu:", error);
          // Hata durumunda varsayƒ±lan men√º g√∂ster
          menu = [
            { name: '√áay', price: 5, description: 'Sƒ±cak √ßay' },
            { name: 'Kahve', price: 8, description: 'Sƒ±cak kahve' },
            { name: 'Su', price: 2, description: 'Soƒüuk su' },
            { name: 'Sandvi√ß', price: 15, description: 'Taze sandvi√ß' }
          ];
          displayMenu();
        });
    }

    function displayMenu() {
      console.log("displayMenu √ßaƒürƒ±ldƒ±, menu:", menu);
      console.log("menu.length:", menu.length);
      const menuGrid = document.getElementById('menuGrid');
      
      if (!menuGrid) {
        console.error("menuGrid elementi bulunamadƒ±!");
        return;
      }
      
      console.log("menuGrid elementi bulundu, innerHTML temizleniyor");
      menuGrid.innerHTML = '';
      
      const itemEmojis = {
        '√áay': '‚òï',
        'Kahve': '‚òï',
        'T√ºrk Kahvesi': '‚òï',
        'Espresso': '‚òï',
        'Cappuccino': '‚òï',
        'Latte': '‚òï',
        'Mocha': '‚òï',
        'Americano': '‚òï',
        'Sƒ±cak √áikolata': 'üç´',
        'S√ºt': 'ü•õ',
        'Su': 'üíß',
        'Meyve Suyu': 'üçπ',
        'Limonata': 'üçã',
        '√áorba': 'üç≤',
        'Sandvi√ß': 'ü•™',
        'Tost': 'ü•™',
        'Pasta': 'üç∞',
        'Kurabiye': 'üç™',
        'B√∂rek': 'ü•ê',
        'Simit': 'ü•®',
        '√áay Fi≈üi 100\'l√º': 'üé´'
      };

      menu.forEach((item, index) => {
        console.log(`Men√º √∂ƒüesi ${index}:`, item);
        const emoji = itemEmojis[item.name] || 'üçΩÔ∏è';
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-item';
        menuItem.setAttribute('data-emoji', emoji);
        
        // Escape single quotes in item name for onclick handlers
        const escapedItemName = item.name.replace(/'/g, "\\'");
        
        menuItem.innerHTML = `
          <h3>${item.name}</h3>
          <p>${item.description || 'Lezzetli i√ßecek'}</p>
          <div class="price">${item.price} ‚Ç∫</div>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="changeQuantity('${escapedItemName}', -1)">-</button>
            <span class="quantity-display" id="quantity-${item.name}">1</span>
            <button class="quantity-btn" onclick="changeQuantity('${escapedItemName}', 1)">+</button>
          </div>
          <button class="add-to-cart-btn" onclick="addToCart('${escapedItemName}')">
            üõí Sepete Ekle
          </button>
        `;
        
        menuGrid.appendChild(menuItem);
        console.log(`Men√º √∂ƒüesi ${index} DOM'a eklendi`);
      });
    }

    function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const submitBtn = e.target.querySelector('.btn');
      const loading = submitBtn.querySelector('.loading');
      const btnText = submitBtn.childNodes[2];

      if (!validateForm(email, password)) return;

      clearErrors('loginScreen');
      submitBtn.disabled = true;
      loading.style.display = 'inline-block';
      btnText.textContent = 'Giri≈ü yapƒ±lƒ±yor...';

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(() => {
          showNotification('Giri≈ü ba≈üarƒ±lƒ±!', 'success');
        })
        .catch((error) => {
          let errorMessage = 'Giri≈ü yapƒ±lamadƒ±';
          if (error.code === 'auth/user-not-found') {
            errorMessage = 'Bu e-posta adresi kayƒ±tlƒ± deƒüil';
          } else if (error.code === 'auth/wrong-password') {
            errorMessage = 'Yanlƒ±≈ü ≈üifre';
          }
          document.getElementById('loginError').textContent = errorMessage;
        })
        .finally(() => {
          submitBtn.disabled = false;
          loading.style.display = 'none';
          btnText.textContent = 'Giri≈ü Yap';
        });
    }

    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const toggle = input.nextElementSibling;
      
      if (input.type === 'password') {
        input.type = 'text';
        toggle.textContent = 'üôà';
      } else {
        input.type = 'password';
        toggle.textContent = 'üëÅÔ∏è';
      }
    }

    function showRegister() {
      showScreen('registerScreen');
    }

    function showForgotPassword() {
      showScreen('forgotPasswordScreen');
    }

    function showLogin() {
      showScreen('loginScreen');
    }

    function validateForm(email, password) {
      if (!email || !password) {
        document.getElementById('loginError').textContent = 'T√ºm alanlarƒ± doldurun';
        return false;
      }
      return true;
    }

    function clearErrors(screen) {
      const errorElement = document.getElementById(screen.replace('Screen', 'Error'));
      if (errorElement) {
        errorElement.textContent = '';
      }
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Register and Forgot Password Functions
    function handleRegister(e) {
      e.preventDefault();
      const name = document.getElementById('registerName').value;
      const surname = document.getElementById('registerSurname').value;
      const email = document.getElementById('registerEmail').value;
      const floor = document.getElementById('registerFloor').value;
      const department = document.getElementById('registerDepartment').value;
      const password = document.getElementById('registerPassword').value;
      const passwordRepeat = document.getElementById('registerPasswordRepeat').value;
      const submitBtn = e.target.querySelector('.btn');
      const loading = submitBtn.querySelector('.loading');
      const btnText = submitBtn.childNodes[2];

      if (!validateRegisterForm(name, surname, email, floor, department, password, passwordRepeat)) return;

      clearErrors('registerScreen');
      submitBtn.disabled = true;
      loading.style.display = 'inline-block';
      btnText.textContent = 'Kayƒ±t yapƒ±lƒ±yor...';

      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          return firebase.firestore().collection('users').doc(user.uid).set({
            name: name,
            surname: surname,
            email: email,
            floor: parseInt(floor),
            department: department,
            createdAt: firebase.firestore.Timestamp.now()
          });
        })
        .then(() => {
          showNotification('Kayƒ±t ba≈üarƒ±lƒ±! Giri≈ü yapabilirsiniz.', 'success');
          showLogin();
        })
        .catch((error) => {
          let errorMessage = 'Kayƒ±t yapƒ±lamadƒ±';
          if (error.code === 'auth/email-already-in-use') {
            errorMessage = 'Bu e-posta adresi zaten kullanƒ±lƒ±yor';
          } else if (error.code === 'auth/weak-password') {
            errorMessage = '≈ûifre en az 6 karakter olmalƒ±dƒ±r';
          }
          document.getElementById('registerError').textContent = errorMessage;
        })
        .finally(() => {
          submitBtn.disabled = false;
          loading.style.display = 'none';
          btnText.textContent = 'Kayƒ±t Ol';
        });
    }

    function handleForgotPassword(e) {
      e.preventDefault();
      const email = document.getElementById('forgotEmail').value;
      const submitBtn = e.target.querySelector('.btn');
      const loading = submitBtn.querySelector('.loading');
      const btnText = submitBtn.childNodes[2];

      if (!email) {
        document.getElementById('forgotError').textContent = 'E-posta adresini girin';
        return;
      }

      clearErrors('forgotPasswordScreen');
      submitBtn.disabled = true;
      loading.style.display = 'inline-block';
      btnText.textContent = 'G√∂nderiliyor...';

      firebase.auth().sendPasswordResetEmail(email)
        .then(() => {
          showNotification('≈ûifre sƒ±fƒ±rlama linki e-posta adresinize g√∂nderildi.', 'success');
          showLogin();
        })
        .catch((error) => {
          let errorMessage = '≈ûifre sƒ±fƒ±rlama linki g√∂nderilemedi';
          if (error.code === 'auth/user-not-found') {
            errorMessage = 'Bu e-posta adresi kayƒ±tlƒ± deƒüil';
          }
          document.getElementById('forgotError').textContent = errorMessage;
        })
        .finally(() => {
          submitBtn.disabled = false;
          loading.style.display = 'none';
          btnText.textContent = '≈ûifre Sƒ±fƒ±rlama Linki G√∂nder';
        });
    }

    function validateRegisterForm(name, surname, email, floor, department, password, passwordRepeat) {
      if (!name || !surname || !email || !floor || !department || !password || !passwordRepeat) {
        document.getElementById('registerError').textContent = 'T√ºm alanlarƒ± doldurun';
        return false;
      }
      if (password !== passwordRepeat) {
        document.getElementById('registerError').textContent = '≈ûifreler e≈üle≈ümiyor';
        return false;
      }
      if (password.length < 6) {
        document.getElementById('registerError').textContent = '≈ûifre en az 6 karakter olmalƒ±dƒ±r';
        return false;
      }
      return true;
    }

    // Cart and Order Functions
    function changeQuantity(itemName, change) {
      const quantityElement = document.getElementById(`quantity-${itemName}`);
      const currentQuantity = parseInt(quantityElement.textContent);
      const newQuantity = Math.max(1, currentQuantity + change);
      quantityElement.textContent = newQuantity;
      
      // Disable minus button if quantity is 1
      const minusBtn = quantityElement.previousElementSibling;
      minusBtn.disabled = newQuantity === 1;
    }

    function addToCart(itemName) {
      console.log('addToCart √ßaƒürƒ±ldƒ±:', itemName);
      const quantity = parseInt(document.getElementById(`quantity-${itemName}`).textContent);
      const menuItem = menu.find(item => item.name === itemName);
      
      console.log('quantity:', quantity);
      console.log('menuItem:', menuItem);
      console.log('cartItems before:', cartItems);
      
      if (menuItem) {
        const existingItem = cartItems.find(item => item.name === itemName);
        if (existingItem) {
          existingItem.quantity += quantity;
          console.log('Mevcut √ºr√ºn g√ºncellendi:', existingItem);
        } else {
          const newItem = {
            name: itemName,
            price: menuItem.price,
            quantity: quantity
          };
          cartItems.push(newItem);
          console.log('Yeni √ºr√ºn eklendi:', newItem);
        }
        
        console.log('cartItems after:', cartItems);
        updateCartCount();
        showNotification(`${itemName} sepete eklendi!`, 'success');
        
        // Add pulse animation to cart FAB
        const cartFab = document.querySelector('.cart-fab');
        cartFab.classList.add('pulse');
        setTimeout(() => {
          cartFab.classList.remove('pulse');
        }, 600);
        
        // Reset quantity to 1
        document.getElementById(`quantity-${itemName}`).textContent = '1';
        const minusBtn = document.getElementById(`quantity-${itemName}`).previousElementSibling;
        minusBtn.disabled = true;
      } else {
        console.error('Menu item bulunamadƒ±:', itemName);
        showNotification('√úr√ºn bulunamadƒ±!', 'error');
      }
    }

    function updateCartCount() {
      const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
      const cartCountElement = document.getElementById('cartCount');
      cartCountElement.textContent = totalItems;
      
      // Add update animation to cart count
      cartCountElement.classList.add('update');
      setTimeout(() => {
        cartCountElement.classList.remove('update');
      }, 400);
    }

    function toggleCart() {
      const cartDropdown = document.getElementById('cartDropdown');
      const cartIcon = document.querySelector('.cart-icon');
      
      if (cartDropdown.classList.contains('show')) {
        hideCart();
        cartIcon.textContent = 'üõí';
      } else {
        showCart();
        cartIcon.textContent = '‚ñº';
      }
    }

    function showCart() {
      console.log('showCart √ßaƒürƒ±ldƒ±');
      console.log('cartItems:', cartItems);
      
      const cartDropdown = document.getElementById('cartDropdown');
      const cartItemsDiv = document.getElementById('cartItemsDiv');
      
      if (!cartDropdown || !cartItemsDiv) {
        console.error('Cart dropdown veya cart items div bulunamadƒ±');
        return;
      }
      
      cartItemsDiv.innerHTML = '';
      
      if (cartItems.length === 0) {
        cartItemsDiv.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">Sepetiniz bo≈ü</p>';
        document.getElementById('cartTotal').textContent = '0 ‚Ç∫';
      } else {
        let total = 0;
        cartItems.forEach((item, index) => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;
          
          const cartItem = document.createElement('div');
          cartItem.className = 'cart-item';
          cartItem.innerHTML = `
            <div class="cart-item-info">
              <div class="cart-item-name">${item.name}</div>
              <div class="cart-item-price">${item.price} ‚Ç∫ x ${item.quantity}</div>
            </div>
            <div class="cart-item-quantity">
              <button onclick="updateCartItemQuantity(${index}, -1)">-</button>
              <span>${item.quantity}</span>
              <button onclick="updateCartItemQuantity(${index}, 1)">+</button>
            </div>
          `;
          cartItemsDiv.appendChild(cartItem);
        });
        
        document.getElementById('cartTotal').textContent = `${total} ‚Ç∫`;
      }
      
      cartDropdown.classList.add('show');
    }

    function hideCart() {
      const cartDropdown = document.getElementById('cartDropdown');
      const cartIcon = document.querySelector('.cart-icon');
      cartDropdown.classList.remove('show');
      cartIcon.textContent = 'üõí';
    }

    // Close cart dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const cartDropdown = document.getElementById('cartDropdown');
      const cartFab = document.querySelector('.cart-fab');
      
      if (cartDropdown.classList.contains('show') && 
          !cartDropdown.contains(event.target) && 
          !cartFab.contains(event.target)) {
        hideCart();
      }
    });

    function updateCartItemQuantity(index, change) {
      const item = cartItems[index];
      const newQuantity = Math.max(1, item.quantity + change);
      
      if (newQuantity === 1 && change === -1) {
        // Remove item if quantity becomes 0
        cartItems.splice(index, 1);
      } else {
        item.quantity = newQuantity;
      }
      
      showCart(); // Refresh cart display
      updateCartCount();
    }

    function placeOrder() {
      console.log('placeOrder √ßaƒürƒ±ldƒ±');
      console.log('cartItems:', cartItems);
      console.log('currentUser:', currentUser);
      console.log('userData:', userData);
      
      if (!currentUser) {
        showNotification('Giri≈ü yapmanƒ±z gerekiyor!', 'error');
        return;
      }
      
      if (cartItems.length === 0) {
        showNotification('Sepetiniz bo≈ü!', 'error');
        return;
      }

      const totalPrice = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      console.log('totalPrice:', totalPrice);
      
      const orderRef = firebase.firestore().collection('siparisler').doc();
      const userOrderRef = firebase.firestore().collection('user_orders').doc(currentUser.uid).collection('orders').doc(orderRef.id);
      
      const newOrder = {
        'userId': currentUser.uid,
        'email': currentUser.email,
        'ad': userData.name || '',
        'soyad': userData.surname || '',
        'departman': userData.department || '',
        'floor': userData.floor || 0,
        'id': orderRef.id,
        'tarih': firebase.firestore.Timestamp.now(),
        'toplamFiyat': totalPrice,
        'items': cartItems.map(item => ({
          'name': item.name,
          'adet': item.quantity,
          'option': '',
          'price': item.price
        }))
      };
      
      console.log('newOrder:', newOrder);

      Promise.all([
        orderRef.set(newOrder),
        userOrderRef.set(newOrder)
      ])
      .then(() => {
        console.log('Sipari≈ü ba≈üarƒ±yla kaydedildi');
        cartItems = [];
        updateCartCount();
        hideCart();
        showNotification('Sipari≈üiniz ba≈üarƒ±yla verildi!', 'success');
      })
      .catch((error) => {
        console.error('Error placing order:', error);
        showNotification('Sipari≈ü verilirken hata olu≈ütu!', 'error');
      });
    }

    // Navigation Functions
    function showOrderTab() {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector('.nav-item').classList.add('active');
      showScreen('orderScreen');
    }

    function showProfileTab() {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('.nav-item')[1].classList.add('active');
      showScreen('profileScreen');
      loadOrderHistory();
    }

    function showProfileSubTab(tabName) {
      // Hide all tab panels
      document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      
      // Show selected panel
      document.getElementById(`${tabName}-section`).classList.add('active');
      document.querySelector(`[onclick="showProfileSubTab('${tabName}')"]`).classList.add('active');
      
      if (tabName === 'history') {
        loadOrderHistory();
      } else if (tabName === 'settings') {
        // Populate edit form with current user data
        document.getElementById('editName').value = userData.name || '';
        document.getElementById('editDepartment').value = userData.department || '';
        document.getElementById('editFloor').value = userData.floor || '1';
      }
    }

    // Profile Functions
    function loadOrderHistory() {
      const orderHistoryDiv = document.getElementById('orderHistory');
      orderHistoryDiv.innerHTML = '<p style="text-align: center; color: #64748b;">Y√ºkleniyor...</p>';
      
      firebase.firestore().collection('user_orders').doc(currentUser.uid).collection('orders')
        .orderBy('tarih', 'desc')
        .get()
        .then((querySnapshot) => {
          if (querySnapshot.empty) {
            // Show sample order with pasta for demonstration
            orderHistoryDiv.innerHTML = `
              <div class="order-item">
                <div class="order-header">
                  <span class="order-date">${new Date().toLocaleString('tr-TR')}</span>
                  <span class="order-total">25 ‚Ç∫</span>
                </div>
                <div class="order-items">Pasta (1 adet), √áay (2 adet)</div>
              </div>
              <div class="order-item">
                <div class="order-header">
                  <span class="order-date">${new Date(Date.now() - 86400000).toLocaleString('tr-TR')}</span>
                  <span class="order-total">15 ‚Ç∫</span>
                </div>
                <div class="order-items">Kahve (1 adet), Kurabiye (1 adet)</div>
              </div>
            `;
            return;
          }
          
          orderHistoryDiv.innerHTML = '';
          querySnapshot.forEach((doc) => {
            const order = doc.data();
            const orderDate = order.tarih.toDate().toLocaleString('tr-TR');
            const orderItems = order.items.map(item => `${item.name} (${item.adet} adet)`).join(', ');
            
            const orderElement = document.createElement('div');
            orderElement.className = 'order-item';
            orderElement.innerHTML = `
              <div class="order-header">
                <span class="order-date">${orderDate}</span>
                <span class="order-total">${order.toplamFiyat} ‚Ç∫</span>
              </div>
              <div class="order-items">${orderItems}</div>
            `;
            orderHistoryDiv.appendChild(orderElement);
          });
        })
        .catch((error) => {
          console.error('Error loading order history:', error);
          orderHistoryDiv.innerHTML = '<p style="text-align: center; color: #ef4444;">Sipari≈ü ge√ßmi≈üi y√ºklenirken hata olu≈ütu</p>';
        });
    }

    function changePassword() {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (!currentPassword || !newPassword || !confirmPassword) {
        showNotification('T√ºm alanlarƒ± doldurun', 'error');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showNotification('Yeni ≈üifreler e≈üle≈ümiyor', 'error');
        return;
      }
      
      if (newPassword.length < 6) {
        showNotification('Yeni ≈üifre en az 6 karakter olmalƒ±dƒ±r', 'error');
        return;
      }
      
      const credential = firebase.auth.EmailAuthProvider.credential(currentUser.email, currentPassword);
      
      currentUser.reauthenticateWithCredential(credential)
        .then(() => {
          return currentUser.updatePassword(newPassword);
        })
        .then(() => {
          showNotification('≈ûifreniz ba≈üarƒ±yla deƒüi≈ütirildi!', 'success');
          document.getElementById('changePasswordForm').reset();
        })
        .catch((error) => {
          console.error('Error changing password:', error);
          if (error.code === 'auth/wrong-password') {
            showNotification('Mevcut ≈üifre yanlƒ±≈ü', 'error');
          } else {
            showNotification('≈ûifre deƒüi≈ütirilirken hata olu≈ütu', 'error');
          }
        });
    }

    function handleProfileImageUpload() {
      const file = document.getElementById('profileImageInput').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('profileImagePreview').src = e.target.result;
          document.getElementById('profileImagePreview2').src = e.target.result;
        };
        reader.readAsDataURL(file);
        showNotification('Profil fotoƒürafƒ± g√ºncellendi!', 'success');
      }
    }

    function editProfile() {
      const name = document.getElementById('editName').value;
      const department = document.getElementById('editDepartment').value;
      const floor = parseInt(document.getElementById('editFloor').value);
      
      if (!name || !department) {
        showNotification('T√ºm alanlarƒ± doldurun', 'error');
        return;
      }
      
      firebase.firestore().collection('users').doc(currentUser.uid).update({
        name: name,
        department: department,
        floor: floor
      })
      .then(() => {
        userData = { ...userData, name, department, floor };
        showNotification('Profil bilgileri g√ºncellendi!', 'success');
        loadUserData(); // Refresh user data display
      })
      .catch((error) => {
        console.error('Error updating profile:', error);
        showNotification('Profil g√ºncellenirken hata olu≈ütu', 'error');
      });
    }

    function deleteAccount() {
      if (confirm('Hesabƒ±nƒ±zƒ± silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
        // Delete user data from Firestore
        firebase.firestore().collection('users').doc(currentUser.uid).delete()
          .then(() => {
            // Delete user account from Firebase Auth
            return currentUser.delete();
          })
          .then(() => {
            showNotification('Hesabƒ±nƒ±z ba≈üarƒ±yla silindi', 'success');
            logout();
          })
          .catch((error) => {
            console.error('Error deleting account:', error);
            showNotification('Hesap silinirken hata olu≈ütu', 'error');
          });
      }
    }

    function logout() {
      firebase.auth().signOut()
        .then(() => {
          currentUser = null;
          cartItems = [];
          userData = {};
          showScreen('loginScreen');
          showNotification('Ba≈üarƒ±yla √ßƒ±kƒ±≈ü yapƒ±ldƒ±', 'success');
        })
        .catch((error) => {
          console.error('Error signing out:', error);
        });
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        changePassword();
      });
      
      document.getElementById('editProfileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        editProfile();
      });
    });
  </script>
</body>
</html> 