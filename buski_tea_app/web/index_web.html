<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buski Çay Saati</title>
  <link rel="icon" type="image/png" href="favicon.png">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: white;
      min-height: 100vh;
      overflow-x: hidden;
      margin: 0;
      padding: 0;
    }
    
    .screen {
      display: none;
      min-height: 100vh;
      padding: 18px;
    }
    
    .screen.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .login-container {
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    
    .logo-section {
      margin-bottom: 40px;
    }
    
    .logo {
      width: 160px;
      height: auto;
      margin-bottom: 6px;
    }
    
    .animated-text {
      max-width: 320px;
      min-height: 40px;
      margin: 0 auto 10px;
      font-size: 15px;
      font-weight: 600;
      color: #333;
      line-height: 1.4;
    }
    
    .page-title {
      font-size: 24px;
      font-weight: bold;
      color: #1565C0;
      margin-bottom: 12px;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-group label {
      display: block;
      text-align: left;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      text-align: center;
      transition: border-color 0.3s;
      box-sizing: border-box;
    }
    
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #1565C0;
    }
    
    .password-field {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: #666;
      font-size: 18px;
    }
    
    .btn {
      width: 100%;
      height: 48px;
      background: #1565C0;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
      margin-bottom: 18px;
      box-shadow: 0 2px 8px rgba(21, 101, 192, 0.3);
    }
    
    .btn:hover {
      background: #1976D2;
      box-shadow: 0 4px 12px rgba(21, 101, 192, 0.4);
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .link-btn {
      background: none;
      border: none;
      color: #1565C0;
      font-weight: 600;
      cursor: pointer;
      text-decoration: underline;
      margin: 5px 0;
      font-size: 14px;
    }
    
    .link-btn:hover {
      color: #1976D2;
    }
    
    .error-message {
      color: #f44336;
      font-size: 14px;
      margin-top: 5px;
      text-align: left;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transform: translateX(400px);
      transition: transform 0.3s;
      z-index: 1000;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: #f44336;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1565C0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Order Screen Styles */
    .order-container {
      max-width: 100%;
      width: 100%;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1976D2 0%, #42A5F5 30%, #90CAF9 70%, #E3F2FD 100%);
    }
    
    .header {
      background: linear-gradient(135deg, #0D47A1 0%, #1976D2 50%, #42A5F5 100%);
      color: white;
      padding: 20px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(25, 118, 210, 0.4);
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 15px;
    }
    
    .header h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }
    
    .menu-item {
      background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(25, 118, 210, 0.15);
      transition: all 0.3s ease;
      border: 2px solid #E3F2FD;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    
    .menu-item::before {
      content: attr(data-emoji);
      position: absolute;
      top: -15px;
      right: -15px;
      font-size: 80px;
      opacity: 0.08;
      transform: rotate(15deg);
    }
    
    .menu-item:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 12px 40px rgba(25, 118, 210, 0.25);
      border-color: #90CAF9;
    }
    
    .menu-item h3 {
      color: #1565C0;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: bold;
      position: relative;
      z-index: 1;
    }
    
    .menu-item p {
      color: #1976D2;
      margin-bottom: 16px;
      font-size: 14px;
      position: relative;
      z-index: 1;
      line-height: 1.5;
    }
    
    .price {
      font-size: 22px;
      font-weight: bold;
      color: #1565C0;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
      padding: 10px 20px;
      border-radius: 30px;
      display: inline-block;
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.2);
      position: relative;
      z-index: 1;
    }
    
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      background: #F8F9FA;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid #E3F2FD;
    }
    
    .quantity-btn {
      width: 40px;
      height: 40px;
      border: 2px solid #1976D2;
      background: white;
      color: #1976D2;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.2);
    }
    
    .quantity-btn:hover {
      background: #1976D2;
      color: white;
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(25, 118, 210, 0.3);
    }
    
    .quantity-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }
    
    .quantity-display {
      font-size: 20px;
      font-weight: bold;
      min-width: 40px;
      text-align: center;
      color: #1565C0;
      background: white;
      padding: 10px 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
    }
    
    .add-to-cart-btn {
      background: linear-gradient(135deg, #1976D2 0%, #42A5F5 100%);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 14px 28px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(25, 118, 210, 0.3);
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    
    .add-to-cart-btn::before {
      content: '🛒';
      margin-right: 10px;
    }
    
    .add-to-cart-btn:hover {
      background: linear-gradient(135deg, #1565C0 0%, #1976D2 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(25, 118, 210, 0.4);
    }
    
    .cart-fab {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, #1976D2 0%, #42A5F5 100%);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 30px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(25, 118, 210, 0.4);
      z-index: 1000;
      transition: all 0.3s ease;
      border: 3px solid #E3F2FD;
    }
    
    .cart-fab:hover {
      transform: scale(1.15) rotate(5deg);
      box-shadow: 0 12px 35px rgba(25, 118, 210, 0.5);
      background: linear-gradient(135deg, #1565C0 0%, #1976D2 100%);
    }
    
    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #f44336;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .cart-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    
    .cart-content {
      background: white;
      border-radius: 12px;
      padding: 20px;
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    
    .cart-item:last-child {
      border-bottom: none;
    }
    
    .cart-total {
      font-size: 18px;
      font-weight: bold;
      margin: 20px 0;
      text-align: center;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);
      border-top-left-radius: 30px;
      border-top-right-radius: 30px;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1000;
      box-shadow: 0 -4px 25px rgba(25, 118, 210, 0.15);
      border-top: 3px solid #E3F2FD;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 12px 8px;
      border-radius: 20px;
      transition: all 0.3s ease;
      flex: 1;
      margin: 0 4px;
    }
    
    .nav-item:hover {
      background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
      transform: translateY(-2px);
    }
    
    .nav-item.active {
      color: #1565C0;
      background: linear-gradient(135deg, #BBDEFB 0%, #90CAF9 100%);
      box-shadow: 0 4px 15px rgba(25, 118, 210, 0.2);
    }
    
    .nav-icon {
      font-size: 26px;
      margin-bottom: 4px;
      transition: all 0.3s ease;
    }
    
    .nav-item.active .nav-icon {
      font-size: 30px;
      transform: scale(1.1);
    }
    
    .nav-text {
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .nav-item.active .nav-text {
      font-size: 14px;
      font-weight: bold;
    }
    
    /* Profile Screen Styles */
    .profile-container {
      max-width: 100%;
      width: 100%;
      min-height: 100vh;
      background: linear-gradient(135deg, #1976D2 0%, #42A5F5 30%, #90CAF9 70%, #E3F2FD 100%);
      padding: 0;
    }
    
    .profile-header {
      background: linear-gradient(135deg, #0D47A1 0%, #1976D2 50%, #42A5F5 100%);
      color: white;
      padding: 30px 20px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(25, 118, 210, 0.4);
    }
    
    .profile-header h1 {
      font-size: 28px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    .avatar {
      font-size: 60px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }
    
    .user-details h2 {
      font-size: 24px;
      margin-bottom: 8px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .user-details p {
      font-size: 14px;
      opacity: 0.9;
      margin: 4px 0;
    }
    
    .profile-tabs {
      display: flex;
      background: white;
      padding: 0;
      box-shadow: 0 2px 10px rgba(93, 64, 55, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 16px;
      border: none;
      background: transparent;
      color: #8D6E63;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }
    
    .tab-btn.active {
      color: #5D4037;
      border-bottom-color: #8D6E63;
      background: linear-gradient(135deg, #EFEBE9 0%, #D7CCC8 100%);
    }
    
    .tab-btn:hover {
      background: #FAFAFA;
    }
    
    .tab-content {
      padding: 20px;
      min-height: calc(100vh - 300px);
    }
    
    .tab-panel {
      display: none;
    }
    
    .tab-panel.active {
      display: block;
    }
    
    .info-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(93, 64, 55, 0.1);
    }
    
    .info-section h3 {
      color: #5D4037;
      font-size: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #EFEBE9;
    }
    
    .info-item:last-child {
      border-bottom: none;
    }
    
    .label {
      font-weight: 600;
      color: #8D6E63;
    }
    
    .action-buttons {
      text-align: center;
      margin-top: 20px;
    }
    
    .history-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(93, 64, 55, 0.1);
    }
    
    .history-section h3 {
      color: #5D4037;
      font-size: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .order-item {
      background: #FAFAFA;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 4px solid #8D6E63;
    }
    
    .order-date {
      font-weight: bold;
      color: #5D4037;
      margin-bottom: 8px;
    }
    
    .order-items {
      color: #8D6E63;
      margin-bottom: 8px;
    }
    
    .order-total {
      font-weight: bold;
      color: #5D4037;
      text-align: right;
    }
    
    @media (max-width: 480px) {
      .login-container {
        padding: 0 20px;
      }
      
      .logo {
        width: 140px;
      }
      
      .animated-text {
        font-size: 14px;
      }
      
      .menu-grid {
        padding: 4px;
      }
      
      .menu-item {
        padding: 6px;
      }
      
      .cart-fab {
        bottom: 70px;
        right: 16px;
        width: 48px;
        height: 48px;
        font-size: 20px;
      }
      
      .user-info {
        flex-direction: column;
        gap: 15px;
      }
      
      .tab-content {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="screen active">
    <div class="login-container">
      <div class="logo-section">
        <img src="assets/images/logo1.png" alt="Buski Logo" class="logo">
        <div class="animated-text" id="loginAnimatedText">
          Çalışırken bi kahve molası fena mı olur?
        </div>
      </div>
      
      <h1 class="page-title">Giriş Yap</h1>
      
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">E-posta adresinizi giriniz.</label>
          <input 
            type="email" 
            id="loginEmail" 
            placeholder="örn: ornek@mail.com"
            required
          >
          <div class="error-message" id="loginEmailError"></div>
        </div>
        
        <div class="form-group">
          <label for="loginPassword">Şifre</label>
          <div class="password-field">
            <input 
              type="password" 
              id="loginPassword" 
              placeholder="Şifrenizi giriniz"
              required
            >
            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
              👁️
            </button>
          </div>
          <div class="error-message" id="loginPasswordError"></div>
        </div>
        
        <button type="submit" class="btn" id="loginBtn">
          Giriş Yap
        </button>
      </form>
      
      <button class="link-btn" onclick="showScreen('registerScreen')">
        Üye değil misiniz? Kayıt olun
      </button>
      
      <button class="link-btn" onclick="showScreen('forgotPasswordScreen')">
        Şifreni mi unuttun?
      </button>
    </div>
  </div>

  <!-- Register Screen -->
  <div id="registerScreen" class="screen">
    <div class="login-container">
      <div class="logo-section">
        <img src="assets/images/logo1.png" alt="Buski Logo" class="logo">
        <div class="animated-text">
          Hoş geldiniz! Hemen kayıt olun.
        </div>
      </div>
      
      <h1 class="page-title">Kayıt Ol</h1>
      
      <form id="registerForm">
        <div class="form-group">
          <label for="registerName">İsim</label>
          <input type="text" id="registerName" placeholder="İsminizi giriniz" required>
          <div class="error-message" id="registerNameError"></div>
        </div>
        
        <div class="form-group">
          <label for="registerSurname">Soyisim</label>
          <input type="text" id="registerSurname" placeholder="Soyisminizi giriniz" required>
          <div class="error-message" id="registerSurnameError"></div>
        </div>
        
        <div class="form-group">
          <label for="registerEmail">E-posta</label>
          <input type="email" id="registerEmail" placeholder="E-posta adresinizi giriniz" required>
          <div class="error-message" id="registerEmailError"></div>
        </div>
        
        <div class="form-group">
          <label for="registerFloor">Bulunduğunuz Kat</label>
          <select id="registerFloor" required>
            <option value="">Kat seçiniz</option>
            <option value="0">Zemin Kat</option>
            <option value="1">1. Kat</option>
            <option value="2">2. Kat</option>
            <option value="3">3. Kat</option>
            <option value="4">4. Kat</option>
            <option value="5">5. Kat</option>
            <option value="6">6. Kat</option>
            <option value="7">7. Kat</option>
            <option value="8">8. Kat</option>
            <option value="9">9. Kat</option>
            <option value="10">10. Kat</option>
          </select>
          <div class="error-message" id="registerFloorError"></div>
        </div>
        
        <div class="form-group">
          <label for="registerDepartment">Departman</label>
          <input type="text" id="registerDepartment" placeholder="Departmanınızı giriniz" required>
          <div class="error-message" id="registerDepartmentError"></div>
        </div>
        
        <div class="form-group">
          <label for="registerPassword">Şifre</label>
          <div class="password-field">
            <input 
              type="password" 
              id="registerPassword" 
              placeholder="Şifrenizi giriniz (en az 6 karakter)"
              required
            >
            <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
              👁️
            </button>
          </div>
          <div class="error-message" id="registerPasswordError"></div>
        </div>
        
        <div class="form-group">
          <label for="registerRepeatPassword">Şifre Tekrar</label>
          <div class="password-field">
            <input 
              type="password" 
              id="registerRepeatPassword" 
              placeholder="Şifrenizi tekrar giriniz"
              required
            >
            <button type="button" class="password-toggle" onclick="togglePassword('registerRepeatPassword')">
              👁️
            </button>
          </div>
          <div class="error-message" id="registerRepeatPasswordError"></div>
        </div>
        
        <button type="submit" class="btn" id="registerBtn">
          Kayıt Ol
        </button>
      </form>
      
      <button class="link-btn" onclick="showScreen('loginScreen')">
        Zaten hesabınız var mı? Giriş yapın
      </button>
    </div>
  </div>

  <!-- Forgot Password Screen -->
  <div id="forgotPasswordScreen" class="screen">
    <div class="login-container">
      <div class="logo-section">
        <img src="assets/images/logo1.png" alt="Buski Logo" class="logo">
        <div class="animated-text">
          Şifrenizi mi unuttunuz? Endişelenmeyin!
        </div>
      </div>
      
      <h1 class="page-title">Şifre Sıfırlama</h1>
      
      <form id="forgotPasswordForm">
        <div class="form-group">
          <label for="forgotPasswordEmail">E-posta</label>
          <input 
            type="email" 
            id="forgotPasswordEmail" 
            placeholder="E-posta adresinizi giriniz"
            required
          >
          <div class="error-message" id="forgotPasswordEmailError"></div>
        </div>
        
        <button type="submit" class="btn" id="forgotPasswordBtn">
          Şifre Sıfırlama E-postası Gönder
        </button>
      </form>
      
      <button class="link-btn" onclick="showScreen('loginScreen')">
        Giriş sayfasına dön
      </button>
    </div>
  </div>

  <!-- Order Screen -->
  <div id="orderScreen" class="screen">
    <div class="order-container">
      <div class="header">
        <h1>🍵 Buski Çay Saati</h1>
        <p>Hoş geldiniz, <span id="userName">Kullanıcı</span>!</p>
        <button class="link-btn" onclick="logout()" style="color: white; margin-top: 10px;">
          Çıkış Yap
        </button>
      </div>
      
      <div id="menuGrid" class="menu-grid">
        <!-- Menu items will be loaded here -->
        <div style="text-align: center; padding: 40px;">
          <div class="loading"></div>
          <p>Menü yükleniyor...</p>
        </div>
      </div>
      
      <button class="cart-fab" onclick="showCart()">
        🛒
        <span class="cart-count" id="cartCount">0</span>
      </button>
      
      <div class="bottom-nav">
        <div class="nav-item active" onclick="showOrderTab()">
          <div class="nav-icon">🍵</div>
          <div class="nav-text">Sipariş</div>
        </div>
        <div class="nav-item" onclick="showProfileTab()">
          <div class="nav-icon">👤</div>
          <div class="nav-text">Profil</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Modal -->
  <div id="cartModal" class="cart-modal">
    <div class="cart-content">
      <h2>🛒 Sepetim</h2>
      <div id="cartItems">
        <!-- Cart items will be loaded here -->
      </div>
      <div class="cart-total">
        Toplam: <span id="cartTotal">0</span> TL
      </div>
      <button class="btn" onclick="placeOrder()">Sipariş Ver</button>
      <button class="link-btn" onclick="hideCart()">Kapat</button>
    </div>
  </div>

  <!-- Profile Screen -->
  <div id="profileScreen" class="screen">
    <div class="profile-container">
      <div class="profile-header">
        <h1>👤 Profil</h1>
        <div class="user-info">
          <div class="avatar">☕</div>
          <div class="user-details">
            <h2 id="profileUserName">Kullanıcı</h2>
            <p id="profileUserEmail">email@example.com</p>
            <p id="profileUserFloor">Kat: -</p>
            <p id="profileUserDepartment">Departman: -</p>
          </div>
        </div>
      </div>
      
      <div class="profile-tabs">
        <button class="tab-btn active" onclick="showProfileTab('info')">Bilgiler</button>
        <button class="tab-btn" onclick="showProfileTab('history')">Geçmiş Siparişler</button>
      </div>
      
      <div class="tab-content">
        <div id="infoTab" class="tab-panel active">
          <div class="info-section">
            <h3>Hesap Bilgileri</h3>
            <div class="info-item">
              <span class="label">Ad Soyad:</span>
              <span id="profileFullName">-</span>
            </div>
            <div class="info-item">
              <span class="label">E-posta:</span>
              <span id="profileEmail">-</span>
            </div>
            <div class="info-item">
              <span class="label">Kat:</span>
              <span id="profileFloor">-</span>
            </div>
            <div class="info-item">
              <span class="label">Departman:</span>
              <span id="profileDept">-</span>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="btn" onclick="logout()">Çıkış Yap</button>
          </div>
        </div>
        
        <div id="historyTab" class="tab-panel">
          <div class="history-section">
            <h3>Sipariş Geçmişi</h3>
            <div id="orderHistory">
              <div class="loading">Geçmiş siparişler yükleniyor...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <script src="firebase-config.js"></script>
  <script>
    // Global variables
    let currentUser = null;
    let cartItems = [];
    let menu = [];
    let userData = {};
    
    // Random sentences from login_screen.dart
    const sentences = [
      'Çayınız demli mi olsun, demsiz mi?',
      'Çalışırken bi kahve molası fena mı olur?',
      'Yoğun tempoya küçük bir tebessüm molası.',
      'Mesain en güzel demlikçisi taze demlenmiş bir bardak çay.',
      'Hayat kısa, çaylar demli!',
    ];
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
      checkAuth();
    });
    
    // Initialize app
    function initializeApp() {
      // Set random sentence for login
      const randomSentence = sentences[Math.floor(Math.random() * sentences.length)];
      document.getElementById('loginAnimatedText').textContent = randomSentence;
      
      // Setup forms
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('registerForm').addEventListener('submit', handleRegister);
      document.getElementById('forgotPasswordForm').addEventListener('submit', handleForgotPassword);
    }
    
    // Check authentication
    function checkAuth() {
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          currentUser = user;
          loadUserData();
          showScreen('orderScreen');
        } else {
          showScreen('loginScreen');
        }
      });
    }
    
    // Load user data
    async function loadUserData() {
      try {
        const userDoc = await firebase.firestore().collection('users').doc(currentUser.uid).get();
        userData = userDoc.data() || {};
        document.getElementById('userName').textContent = userData.name || 'Kullanıcı';
        
        // Update profile screen data
        document.getElementById('profileUserName').textContent = userData.name || 'Kullanıcı';
        document.getElementById('profileUserEmail').textContent = currentUser.email || 'email@example.com';
        document.getElementById('profileUserFloor').textContent = `Kat: ${userData.floor || 0}`;
        document.getElementById('profileUserDepartment').textContent = `Departman: ${userData.department || '-'}`;
        
        document.getElementById('profileFullName').textContent = `${userData.name || ''} ${userData.surname || ''}`;
        document.getElementById('profileEmail').textContent = currentUser.email || '-';
        document.getElementById('profileFloor').textContent = userData.floor || '-';
        document.getElementById('profileDept').textContent = userData.department || '-';
        
        loadMenu();
      } catch (error) {
        console.error('Error loading user data:', error);
      }
    }
    
    // Load menu
    async function loadMenu() {
      try {
        const floor = userData.floor || 0;
        let menuCollection = 'kat123';
        
        if (floor >= 0 && floor <= 3) {
          menuCollection = 'kat123';
        } else if (floor >= 4 && floor <= 6) {
          menuCollection = 'kat456';
        } else if (floor >= 7 && floor <= 10) {
          menuCollection = 'kat78910';
        }
        
        const menuDoc = await firebase.firestore().collection('menu').doc(menuCollection).get();
        menu = menuDoc.data()?.items || [];
        displayMenu();
      } catch (error) {
        console.error('Error loading menu:', error);
        showNotification('Menü yüklenirken hata oluştu', 'error');
      }
    }
    
    // Display menu
    function displayMenu() {
      const menuGrid = document.getElementById('menuGrid');
      menuGrid.innerHTML = '';
      
      if (menu.length === 0) {
        menuGrid.innerHTML = '<div style="text-align: center; padding: 40px;"><p>Menü henüz yüklenmedi</p></div>';
        return;
      }
      
      // Ürün emojileri
      const itemEmojis = {
        'Çay': '☕',
        'Kahve': '☕',
        'Türk Kahvesi': '☕',
        'Espresso': '☕',
        'Cappuccino': '☕',
        'Latte': '☕',
        'Mocha': '☕',
        'Americano': '☕',
        'Su': '💧',
        'Meyve Suyu': '🧃',
        'Kola': '🥤',
        'Fanta': '🥤',
        'Sprite': '🥤',
        'Ayran': '🥛',
        'Süt': '🥛',
        'Çikolata': '🍫',
        'Bisküvi': '🍪',
        'Kek': '🧁',
        'Pasta': '🎂',
        'Sandviç': '🥪',
        'Tost': '🥪',
        'Hamburger': '🍔',
        'Pizza': '🍕',
        'Salata': '🥗',
        'Meyve': '🍎',
        'Elma': '🍎',
        'Muz': '🍌',
        'Portakal': '🍊',
        'Çilek': '🍓',
        'Üzüm': '🍇',
        'Kiraz': '🍒',
        'Şeftali': '🍑',
        'Karpuz': '🍉',
        'Kavun': '🍈',
        'Ananas': '🍍',
        'Mango': '🥭',
        'Avokado': '🥑',
        'Limon': '🍋',
        'Lime': '🍋',
        'Kivi': '🥝',
        'Nar': '🍎',
        'İncir': '🍎',
        'Kayısı': '🍑',
        'Erik': '🍑',
        'Armut': '🍐',
        'Ayva': '🍐',
        'Badem': '🥜',
        'Fındık': '🥜',
        'Ceviz': '🥜',
        'Antep Fıstığı': '🥜',
        'Kaju': '🥜',
        'Fıstık': '🥜',
        'Leblebi': '🥜',
        'Kuruyemiş': '🥜',
        'Çekirdek': '🌻',
        'Kabak Çekirdeği': '🌻',
        'Ay Çekirdeği': '🌻',
        'Karpuz Çekirdeği': '🌻',
        'Cips': '🥔',
        'Patates Cipsi': '🥔',
        'Mısır Cipsi': '🥔',
        'Kraker': '🍘',
        'Bisküvi': '🍪',
        'Kurabiye': '🍪',
        'Çikolata': '🍫',
        'Şeker': '🍬',
        'Sakız': '🍬',
        'Lolipop': '🍭',
        'Dondurma': '🍦',
        'Meyve Dondurması': '🍦',
        'Çikolata Dondurması': '🍦',
        'Vanilya Dondurması': '🍦',
        'Çilek Dondurması': '🍦',
        'Muz Dondurması': '🍦',
        'Karamel Dondurması': '🍦',
        'Fıstık Ezmesi Dondurması': '🍦',
        'Sos': '🍯',
        'Ketçap': '🍯',
        'Mayonez': '🍯',
        'Hardal': '🍯',
        'BBQ Sos': '🍯',
        'Ranch Sos': '🍯',
        'Tatlı Sos': '🍯',
        'Çikolata Sosu': '🍯',
        'Karamel Sosu': '🍯',
        'Meyve Sosu': '🍯',
        'Çilek Sosu': '🍯',
        'Ahududu Sosu': '🍯',
        'Mavi Meyve Sosu': '🍯',
        'Krema': '🍦',
        'Süt Kreması': '🍦',
        'Çikolata Kreması': '🍦',
        'Meyve Kreması': '🍦',
        'Çilek Kreması': '🍦',
        'Vanilya Kreması': '🍦',
        'Karamel Kreması': '🍦',
        'Fıstık Ezmesi Kreması': '🍦',
        'Krema': '🍦',
        'Süt Kreması': '🍦',
        'Çikolata Kreması': '🍦',
        'Meyve Kreması': '🍦',
        'Çilek Kreması': '🍦',
        'Vanilya Kreması': '🍦',
        'Karamel Kreması': '🍦',
        'Fıstık Ezmesi Kreması': '🍦'
      };
      
      menu.forEach((item, index) => {
        const emoji = itemEmojis[item.name] || '🍽️';
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-item';
        menuItem.setAttribute('data-emoji', emoji);
        menuItem.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px;">
            <h3 style="flex: 1; margin-right: 8px;">${item.name}</h3>
            <div class="price">${item.price} TL</div>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="color: #333; font-weight: 500; font-size: 13px;">Adet:</span>
            <button class="quantity-btn" onclick="changeQuantity('${item.name}', -1)">-</button>
            <span class="quantity-display" id="quantity-${item.name}">1</span>
            <button class="quantity-btn" onclick="changeQuantity('${item.name}', 1)">+</button>
            <button class="add-to-cart-btn" onclick="addToCart('${item.name}')">
              Sepete Ekle
            </button>
          </div>
        `;
        menuGrid.appendChild(menuItem);
      });
    }
    
    // Show screen
    function showScreen(screenId) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show target screen
      document.getElementById(screenId).classList.add('active');
    }
    
    // Handle login
    async function handleLogin(e) {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const loginBtn = document.getElementById('loginBtn');
      
      clearErrors('login');
      
      if (!validateLoginForm(email, password)) {
        return;
      }
      
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span class="loading"></span>Giriş yapılıyor...';
      
      try {
        await firebase.auth().signInWithEmailAndPassword(email, password);
        showNotification('Giriş başarılı!', 'success');
      } catch (error) {
        console.error('Login error:', error);
        showNotification('E-posta veya şifre yanlış!', 'error');
        loginBtn.disabled = false;
        loginBtn.textContent = 'Giriş Yap';
      }
    }
    
    // Validate login form
    function validateLoginForm(email, password) {
      let isValid = true;
      
      if (!email || !email.includes('@')) {
        document.getElementById('loginEmailError').textContent = 'Geçerli bir e-posta giriniz';
        isValid = false;
      }
      
      if (!password) {
        document.getElementById('loginPasswordError').textContent = 'Şifre giriniz';
        isValid = false;
      }
      
      return isValid;
    }
    
    // Clear errors
    function clearErrors(formType) {
      const errorElements = document.querySelectorAll(`[id$="Error"]`);
      errorElements.forEach(element => {
        if (element.id.startsWith(formType)) {
          element.textContent = '';
        }
      });
    }
    
    // Toggle password visibility
    function togglePassword(inputId) {
      const passwordInput = document.getElementById(inputId);
      const toggleBtn = passwordInput.parentElement.querySelector('.password-toggle');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleBtn.textContent = '🙈';
      } else {
        passwordInput.type = 'password';
        toggleBtn.textContent = '👁️';
      }
    }
    
    // Handle register
    async function handleRegister(e) {
      e.preventDefault();
      
      const name = document.getElementById('registerName').value.trim();
      const surname = document.getElementById('registerSurname').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const floor = document.getElementById('registerFloor').value;
      const department = document.getElementById('registerDepartment').value.trim();
      const password = document.getElementById('registerPassword').value;
      const repeatPassword = document.getElementById('registerRepeatPassword').value;
      const registerBtn = document.getElementById('registerBtn');
      
      clearErrors('register');
      
      if (!validateRegisterForm(name, surname, email, floor, department, password, repeatPassword)) {
        return;
      }
      
      registerBtn.disabled = true;
      registerBtn.innerHTML = '<span class="loading"></span>Kayıt yapılıyor...';
      
      try {
        const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
        
        const userData = {
          name: name,
          surname: surname,
          email: email,
          floor: parseInt(floor),
          department: department,
          createdAt: firebase.firestore.Timestamp.now()
        };
        
        await firebase.firestore().collection('users').doc(userCredential.user.uid).set(userData);
        
        showNotification('Kayıt başarılı!', 'success');
        showScreen('loginScreen');
      } catch (error) {
        console.error('Register error:', error);
        showNotification('Kayıt sırasında hata oluştu: ' + error.message, 'error');
        registerBtn.disabled = false;
        registerBtn.textContent = 'Kayıt Ol';
      }
    }
    
    // Handle forgot password
    async function handleForgotPassword(e) {
      e.preventDefault();
      
      const email = document.getElementById('forgotPasswordEmail').value.trim();
      const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
      
      clearErrors('forgotPassword');
      
      if (!email || !email.includes('@')) {
        document.getElementById('forgotPasswordEmailError').textContent = 'Geçerli bir e-posta giriniz';
        return;
      }
      
      forgotPasswordBtn.disabled = true;
      forgotPasswordBtn.innerHTML = '<span class="loading"></span>Gönderiliyor...';
      
      try {
        await firebase.auth().sendPasswordResetEmail(email);
        showNotification('Şifre sıfırlama e-postası gönderildi!', 'success');
        showScreen('loginScreen');
      } catch (error) {
        console.error('Forgot password error:', error);
        showNotification('E-posta gönderilirken hata oluştu', 'error');
        forgotPasswordBtn.disabled = false;
        forgotPasswordBtn.textContent = 'Şifre Sıfırlama E-postası Gönder';
      }
    }
    
    // Validate register form
    function validateRegisterForm(name, surname, email, floor, department, password, repeatPassword) {
      let isValid = true;
      
      if (!name) {
        document.getElementById('registerNameError').textContent = 'İsim giriniz';
        isValid = false;
      }
      
      if (!surname) {
        document.getElementById('registerSurnameError').textContent = 'Soyisim giriniz';
        isValid = false;
      }
      
      if (!email || !email.includes('@')) {
        document.getElementById('registerEmailError').textContent = 'Geçerli bir e-posta giriniz';
        isValid = false;
      }
      
      if (!floor) {
        document.getElementById('registerFloorError').textContent = 'Kat seçiniz';
        isValid = false;
      }
      
      if (!department) {
        document.getElementById('registerDepartmentError').textContent = 'Departman giriniz';
        isValid = false;
      }
      
      if (!password || password.length < 6) {
        document.getElementById('registerPasswordError').textContent = 'Şifre en az 6 karakter olmalı';
        isValid = false;
      }
      
      if (password !== repeatPassword) {
        document.getElementById('registerRepeatPasswordError').textContent = 'Şifreler eşleşmiyor';
        isValid = false;
      }
      
      return isValid;
    }
    
    // Change quantity
    function changeQuantity(itemName, change) {
      const quantityElement = document.getElementById(`quantity-${itemName}`);
      let currentQuantity = parseInt(quantityElement.textContent) || 1;
      currentQuantity = Math.max(1, currentQuantity + change);
      quantityElement.textContent = currentQuantity;
      
      // Disable/enable minus button
      const minusBtn = quantityElement.previousElementSibling;
      if (minusBtn) {
        minusBtn.disabled = currentQuantity <= 1;
      }
    }
    
    // Add to cart
    function addToCart(itemName) {
      const quantity = parseInt(document.getElementById(`quantity-${itemName}`).textContent) || 1;
      
      const menuItem = menu.find(item => item.name === itemName);
      if (!menuItem) return;
      
      const existingItem = cartItems.find(item => item.name === itemName);
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cartItems.push({
          name: itemName,
          price: menuItem.price,
          quantity: quantity
        });
      }
      
      updateCartCount();
      showNotification(`${itemName} sepete eklendi`, 'success');
      document.getElementById(`quantity-${itemName}`).textContent = '1';
    }
    
    // Update cart count
    function updateCartCount() {
      const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = totalItems;
    }
    
    // Show cart
    function showCart() {
      const cartModal = document.getElementById('cartModal');
      const cartItemsDiv = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');
      
      cartItemsDiv.innerHTML = '';
      let total = 0;
      
      cartItems.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <div>
            <strong>${item.name}</strong><br>
            <small>${item.quantity} adet x ${item.price} TL</small>
          </div>
          <div>
            <strong>${itemTotal} TL</strong>
            <button class="link-btn" onclick="removeFromCart('${item.name}')">Sil</button>
          </div>
        `;
        cartItemsDiv.appendChild(cartItem);
      });
      
      cartTotal.textContent = total;
      cartModal.style.display = 'flex';
    }
    
    // Hide cart
    function hideCart() {
      document.getElementById('cartModal').style.display = 'none';
    }
    
    // Remove from cart
    function removeFromCart(itemName) {
      cartItems = cartItems.filter(item => item.name !== itemName);
      updateCartCount();
      showCart(); // Refresh cart display
    }
    
    // Place order
    async function placeOrder() {
      if (cartItems.length === 0) {
        showNotification('Sepetiniz boş', 'error');
        return;
      }
      
      try {
        const totalPrice = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Mobil uygulamadaki sipariş yapısına uygun veri hazırla
        const orderRef = firebase.firestore().collection('siparisler').doc();
        const userOrderRef = firebase.firestore().collection('user_orders').doc(currentUser.uid).collection('orders').doc(orderRef.id);
        
        const newOrder = {
          // Kullanıcı bilgileri
          'userId': currentUser.uid,
          'email': currentUser.email,
          'ad': userData.name || '',
          'soyad': userData.surname || '',
          'departman': userData.department || '',
          'floor': userData.floor || 0,
          // Sipariş bilgileri
          'id': orderRef.id,
          'tarih': firebase.firestore.Timestamp.now(),
          'toplamFiyat': totalPrice,
          'items': cartItems.map(item => ({
            'name': item.name,
            'adet': item.quantity,
            'option': '',
            'price': item.price
          }))
        };
        
        // Hem ana siparişler koleksiyonuna hem de kullanıcının siparişlerine kaydet
        await Promise.all([
          orderRef.set(newOrder),
          userOrderRef.set(newOrder)
        ]);
        
        cartItems = [];
        updateCartCount();
        hideCart();
        showNotification('Siparişiniz başarıyla verildi!', 'success');
      } catch (error) {
        console.error('Error placing order:', error);
        showNotification('Sipariş verilirken hata oluştu', 'error');
      }
    }
    
    // Logout
    async function logout() {
      try {
        await firebase.auth().signOut();
        cartItems = [];
        menu = [];
        userData = {};
        showScreen('loginScreen');
        showNotification('Çıkış yapıldı', 'success');
      } catch (error) {
        console.error('Logout error:', error);
        showNotification('Çıkış yapılırken hata oluştu', 'error');
      }
    }
    
    // Navigation functions
    function showOrderTab() {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector('.nav-item').classList.add('active');
      showScreen('orderScreen');
    }
    
    function showHistoryTab() {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('.nav-item')[1].classList.add('active');
      showNotification('Geçmiş siparişler profil sayfasında!', 'success');
    }
    
    function showProfileTab() {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('.nav-item')[2].classList.add('active');
      showScreen('profileScreen');
      loadOrderHistory();
    }
    
    // Profile tab functions
    function showProfileTab(tabName) {
      // Hide all tab panels
      document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
      
      if (tabName === 'history') {
        loadOrderHistory();
      }
    }
    
    // Load order history
    async function loadOrderHistory() {
      try {
        const orderHistoryDiv = document.getElementById('orderHistory');
        orderHistoryDiv.innerHTML = '<div class="loading">Geçmiş siparişler yükleniyor...</div>';
        
        const ordersSnapshot = await firebase.firestore()
          .collection('user_orders')
          .doc(currentUser.uid)
          .collection('orders')
          .orderBy('tarih', 'desc')
          .limit(20)
          .get();
        
        if (ordersSnapshot.empty) {
          orderHistoryDiv.innerHTML = '<div style="text-align: center; padding: 40px; color: #8D6E63;"><p>Henüz sipariş geçmişiniz bulunmuyor.</p></div>';
          return;
        }
        
        orderHistoryDiv.innerHTML = '';
        
        ordersSnapshot.forEach(doc => {
          const order = doc.data();
          const orderDate = order.tarih.toDate();
          const formattedDate = orderDate.toLocaleDateString('tr-TR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          const orderItems = order.items.map(item => `${item.name} (${item.adet} adet)`).join(', ');
          
          const orderElement = document.createElement('div');
          orderElement.className = 'order-item';
          orderElement.innerHTML = `
            <div class="order-date">${formattedDate}</div>
            <div class="order-items">${orderItems}</div>
            <div class="order-total">Toplam: ${order.toplamFiyat} TL</div>
          `;
          
          orderHistoryDiv.appendChild(orderElement);
        });
      } catch (error) {
        console.error('Error loading order history:', error);
        document.getElementById('orderHistory').innerHTML = '<div style="text-align: center; padding: 40px; color: #f44336;"><p>Sipariş geçmişi yüklenirken hata oluştu.</p></div>';
      }
    }
    
    // Show notification
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }
  </script>
</body>
</html> 